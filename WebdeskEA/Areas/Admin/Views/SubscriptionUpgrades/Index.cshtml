@model RegistrationViewModel
@{
    ViewData["Title"] = "SubscriptonUpgrade";
}
@if (!ViewData.ModelState.IsValid)
{
    foreach (var state in ViewData.ModelState)
    {
        if (state.Value.Errors.Count > 0)
        {
            foreach (var error in state.Value.Errors)
            {
                <script>
                    notyf.error({
                        message: '@error.ErrorMessage',
                        duration: 10000 // 10 seconds
                    });
                </script>
            }
        }
    }
}


<form enctype="multipart/form-data"
      asp-area="Admin"
      asp-controller="SubscriptionUpgrades"
      asp-action="Index"
      method="post"
      class="js-step-form-validate js-validate"
      data-hs-step-form-options='{
        "progressSelector": "#addUserStepFormProgress",
        "stepsSelector": "#addUserStepFormContent",
        "endSelector": "#addUserFinishBtn",
    "isValidate": true
        }'>
    <div class="row justify-content-lg-center">

        <!-- ==============================-->
        <!-- ======== Right Side ==========-->
        <!-- ==============================-->
        <div class="col-lg-10 px-4 pt-5 pe-5">
            <!--=====================-->
            <!-- Step -->
            <!--=====================-->
            <ul id="addUserStepFormProgress"
                class="js-step-progress step step-sm step-icon-sm step step-inline step-item-between mb-3 mb-md-5">
                <li class="step-item">
                    <a class="step-content-wrapper" href="javascript:;" data-hs-step-form-next-options='{
                        "targetSelector": "#Tenant"
                            }'>
                        <span class="step-icon step-icon-soft-dark">1</span>
                        <div class="step-content">
                            <span class="step-title">Tenant</span>
                        </div>
                    </a>
                </li>

                <li class="step-item">
                    <a class="step-content-wrapper" href="javascript:;" data-hs-step-form-next-options='{
                        "targetSelector": "#Subscription"
                            }'>
                        <span class="step-icon step-icon-soft-dark">2</span>
                        <div class="step-content">
                            <span class="step-title">Subscription</span>
                        </div>
                    </a>
                </li>
            </ul>

            <!--=====================-->
            <!-- Content Step Form -->
            <!--=====================-->
            <div id="addUserStepFormContent">
                <!--=====================-->
                <!--= Tenant =-->
                <!--=====================-->
                <div id="Tenant" class="card card-lg active">
                    <!-- Body -->
                    <div class="card-body">
                        <div class="row mb-4">
                            <label class="col-sm-3 col-form-label form-label">Logo</label>
                            <div class="col-sm-9">
                                <div class="d-flex align-items-center">
                                    <label class="avatar avatar-xl avatar-circle avatar-uploader me-5" for="avatarUploader">
                                        <img id="avatarImg" class="avatar-img" src="@Url.Content(Model.CompanyDto.Logo)" alt="Image Description">
                                        <input type="file" asp-for="CompanyDto.CompanyImageForSave" class="js-file-attach avatar-uploader-input" id="avatarUploader" data-hs-file-attach-options='{
                                                "textTarget": "#avatarImg",
                                                "mode": "image",
                                                "targetAttr": "src",
                                                "resetTarget": ".js-file-attach-reset-img",
                                                "resetImg": "./~/Template/img/160x160/img1.jpg",
                                                "allowTypes": [".png", ".jpeg", ".jpg"]
                                            }'>
                                        <span class="avatar-uploader-trigger">
                                            <i class="bi-pencil avatar-uploader-icon shadow-sm"></i>
                                        </span>
                                    </label>
                                    <button type="button" class="js-file-attach-reset-img btn btn-white">Delete</button>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-4">
                            <label for="firstNameLabel" class="col-sm-3 col-form-label form-label">Name <i class="bi-question-circle text-body ms-1" disabled data-bs-toggle="tooltip" data-bs-placement="top" title="Displayed on public forums, such as Front."></i></label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" asp-for="TenantDto.TenantName" id="firstNameLabel" placeholder="First Name" aria-label="Clarice" required data-msg="Please enter your username.">
                                <span class="invalid-feedback">FullName Required</span>
                            </div>
                        </div>
                        <div class="row mb-4">
                            <label for="emailLabel" class="col-sm-3 col-form-label form-label">Email</label>
                            <div class="col-sm-9">
                                <input type="email" class="form-control" asp-for="TenantDto.TenantEmail" id="emailLabel" placeholder="clarice@site.com" aria-label="clarice@site.com" required disabled>
                                <span class="invalid-feedback">Email Required</span>
                            </div>
                        </div>
                        <div class="row mb-4">
                            <label for="phoneLabel" class="col-sm-3 col-form-label form-label">Phone</label>
                            <div class="col-sm-9">
                                <input type="text" asp-for="ApplicationUserDto.PhoneNumber" class="form-control" placeholder="phoneNumber">
                            </div>
                        </div>
                        <div class="row mb-4">
                            <label for="UserNameLabel" class="col-sm-3 col-form-label form-label">User Name</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" asp-for="ApplicationUserDto.UserName" placeholder="test@gmail.com" required disabled>
                                <span class="invalid-feedback">UserName Required</span>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <label for="UserNameLabel" class="col-sm-3 col-form-label form-label">Postal Code</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" asp-for="ApplicationUserDto.PostalCode" placeholder="Enter Postal Code">
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <label for="UserNameLabel" class="col-sm-3 col-form-label form-label">Address</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" asp-for="ApplicationUserDto.StreetAddress" placeholder="Enter Address">
                            </div>
                        </div>

                    </div>

                    <!-- Footer -->
                    <div class="card-footer d-flex justify-content-end align-items-center">
                        <button type="button" class="btn btn-primary" data-hs-step-form-next-options='{"targetSelector": "#Subscription"}'>
                            Next <i class="bi-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!--=====================-->
                <!----= Subscription =----->
                <!--=====================-->
                <div id="Subscription" class="card card-lg" style="display: none;">
                    <div class="card-body">
                        <div class="text-center">
                            <div class="h1">
                                <span class="badge bg-primary rounded-pill text-uppercase">
                                    <i class="bi-patch-check-fill me-1"></i> @(Model!.SubscriptionUpgrades_PermisssionsDto!.FirstOrDefault()!.PackageName)
                                </span>
                            </div>
                            <div class="mb-4">
                                <h2>Your Current Subscription Plane</h2>
                            </div>
                            <p>To Use More Feautures Please Ugrade to to Paid Plane. <a class="link" href="#">Learn More <i class="bi-chevron-right"></i></a></p>
                            <a class="btn btn-primary" href="#">Upgrade to premium</a>
                        </div>
                        <div class="mb-3 mb-lg-5 mt-5">
                            <div class="card-header card-header-content-between">
                                <h5>Permissions</h5>
                                @* <a class="link" href="javascript:;">Upgrade</a> *@
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-4">
                                        Total Company Allowed
                                    </div>
                                    <div class="col-8">
                                        <span class="h3">
                                            <span class="badge bg-soft-dark text-dark rounded-pill">
                                                @(Model!.SubscriptionUpgrades_PermisssionsDto!.FirstOrDefault()!.TotalCompany)
                                            </span>
                                        </span>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-4">
                                        Total Users Allowed
                                    </div>
                                    <div class="col-8">
                                        <span class="h3">
                                            <span class="badge bg-soft-dark text-dark rounded-pill">
                                                @(Model!.SubscriptionUpgrades_PermisssionsDto!.FirstOrDefault()!.TotalUser)
                                            </span>
                                        </span>
                                    </div>
                                </div>
                                @foreach (var item in Model.SubscriptionUpgrades_PermisssionsDto.ToList())
                                {
                                    @if (item.ModuleName != null){
                                        <div class="row mt-3">
                                            <div class="col-4">
                                                @(item.ModuleName)
                                            </div>
                                            <div class="col-8">
                                                <span class="h3">
                                                    @{
                                                        var permissions = item.Permissions?.Split(',', System.StringSplitOptions.RemoveEmptyEntries) ?? new string[0];
                                                    }
                                                    @foreach (var permission in permissions)
                                                    {
                                                        <span class="badge bg-soft-dark text-dark rounded-pill" style="font-size:12px">@permission.Trim()</span>
                                                    }
                                                </span>
                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-sm-flex align-items-sm-center">
                        <button type="button" class="btn btn-ghost-secondary mb-2 mb-sm-0" data-hs-step-form-prev-options='{
                        "targetSelector": "#Tenant"
                                }'>
                            <i class="bi-chevron-left"></i> Previous step
                        </button>

                        <div class="ms-auto">
                            <button id="addUserFinishBtn" type="submit" class="btn btn-primary" >Finalize</button>
                        </div>
                    </div>
                </div>

            </div>


            <!--=====================-->
            <!-- Message Body -->
            <!--=====================-->
            @{
                /*
            <div id="successMessageContent" style="display:none;">
                <div class="text-center mt-5 pt-5">
                    <img class="img-fluid mb-3" src="~/Template/svg/illustrations/oc-hi-five.svg" alt="Image Description" data-hs-theme-appearance="default" style="max-width: 15rem;">

                    <div class="mb-4">
                        <h2>Please Continue to Signup Suceess!</h2>
                        @* <p>New <span class="fw-semibold text-dark">Ella Lauda</span> user has been successfully created.</p> *@
                    </div>

                    <div class="d-flex justify-content-center">
                        @* <a class="btn btn-white me-3" href="users.html">
                        <i class="bi-chevron-left ms-1"></i>
                        </a> *@
                        <button class="btn btn-primary" href="users-add-user.html" type="submit">
                            <i class="bi-person-plus-fill me-1"></i> Register Now
                        </button>
                    </div>
                </div>
            </div>
            
        */
        }

        </div>
    </div>
</form>


@section Scripts {
    <script>
        (function () {
            window.onload = function () {
                // INITIALIZATION OF STEP FORM
                // =======================================================
                new HSStepForm('.js-step-form-validate', {
                    validator: HSBsValidation.init('.js-validate'),
                    finish($el) {
                        const $successMessageTempalte = $el.querySelector('.js-success-message').cloneNode(true)

                        $successMessageTempalte.style.display = 'block'

                        $el.style.display = 'none'
                        $el.parentElement.appendChild($successMessageTempalte)
                    }
                })

                // INITIALIZATION OF NAVBAR VERTICAL ASIDE
                // =======================================================
                new HSSideNav('.js-navbar-vertical-aside').init()


                // INITIALIZATION OF FORM SEARCH
                // =======================================================
                new HSFormSearch('.js-form-search')


                // INITIALIZATION OF BOOTSTRAP DROPDOWN
                // =======================================================
                HSBsDropdown.init()


                // INITIALIZATION OF FILE ATTACH
                // =======================================================
                new HSFileAttach('.js-file-attach')


                // INITIALIZATION OF STEP FORM
                // =======================================================
                new HSStepForm('.js-step-form-validate', {
                    finish: () => {
                        // document.getElementById("addUserStepFormProgress").style.display = 'none'
                        // document.getElementById("Tenant").style.display = 'none'
                        // document.getElementById("Subscription").style.display = 'none'
                        // console.log(document.getElementById("addUserStepFormProgress"))
                        // document.getElementById("successMessageContent").style.display = 'block'
                        // scrollToTop('#header');
                        // const formContainer = document.getElementById('formContainer')
                    },
                    onNextStep: function () {
                        scrollToTop()
                    },
                    onPrevStep: function () {
                        scrollToTop()
                    }
                })

                function scrollToTop(el = '.js-step-form-validate') {
                    el = document.querySelector(el)
                    window.scrollTo({
                        top: (el.getBoundingClientRect().top + window.scrollY) - 30,
                        left: 0,
                        behavior: 'smooth'
                    })
                }


                // INITIALIZATION OF ADD FIELD
                // =======================================================
                new HSAddField('.js-add-field', {
                    addedField: field => {
                        HSCore.components.HSTomSelect.init(field.querySelector('.js-select-dynamic'))
                        HSCore.components.HSMask.init(field.querySelector('.js-input-mask'))
                    }
                })


                // INITIALIZATION OF SELECT
                // =======================================================
                HSCore.components.HSTomSelect.init('.js-select', {
                    render: {
                        'option': function (data, escape) {
                            return data.optionTemplate || `<div>${data.text}</div>>`
                        },
                        'item': function (data, escape) {
                            return data.optionTemplate || `<div>${data.text}</div>>`
                        }
                    }
                })


                // INITIALIZATION OF INPUT MASK
                // =======================================================
                HSCore.components.HSMask.init('.js-input-mask')


                // INITIALIZATION OF TOGGLE PASSWORD
                // =======================================================
                new HSTogglePassword('.js-toggle-password')

                //========================= dorpdown select ===================
                // Country -> State Change
                // document.getElementById('CompanyDto_CountryId').addEventListener('change', function () {
                //     var countryId = this.value;
                //     var stateSelect = document.getElementById('stateSelect');
                //     var citySelect = document.getElementById('citySelect');
                //     alert(countryId)

                //     if (countryId) {
                //         // Make an AJAX request to get states by country
                //         fetch(`/Registration/Registration/GetStatesByCountry?countryId=${countryId}`)
                //             .then(response => response.json())
                //             .then(states => {
                //                 // Clear the state and city dropdowns
                //                 stateSelect.innerHTML = '<option value="">--- Select State ---</option>';
                //                 citySelect.innerHTML = '<option value="">--- Select City ---</option>';

                //                 // Populate state dropdown with fetched data
                //                 states.forEach(state => {
                //                     var option = document.createElement('option');
                //                     option.value = state.Id;
                //                     option.textContent = state.StateProvinceName;
                //                     stateSelect.appendChild(option);
                //                 });

                //                 // Reinitialize Tom Select for the updated dropdown
                //                 HSCore.components.HSTomSelect.init(stateSelect);
                //             });
                //     }
                // });

                // // State -> City Change
                // document.getElementById('CompanyDto_StateId').addEventListener('change', function () {
                //     var stateId = this.value;
                //     var citySelect = document.getElementById('citySelect');
                //     alert()

                //     if (stateId) {
                //         // Make an AJAX request to get cities by state
                //         fetch(`/Registration/Registration/GetCitiesByState?stateId=${stateId}`)
                //             .then(response => response.json())
                //             .then(cities => {
                //                 // Clear the city dropdown
                //                 citySelect.innerHTML = '<option value="">--- Select City ---</option>';

                //                 // Populate city dropdown with fetched data
                //                 cities.forEach(city => {
                //                     var option = document.createElement('option');
                //                     option.value = city.Id;
                //                     option.textContent = city.Name;
                //                     citySelect.appendChild(option);
                //                 });

                //                 // Reinitialize Tom Select for the updated dropdown
                //                 HSCore.components.HSTomSelect.init(citySelect);
                //             });
                //     }
                // });



            }
        })()
    </script>

    <script>
        (function () {
            // STYLE SWITCHER
            // =======================================================
            const $dropdownBtn = document.getElementById('selectThemeDropdown') // Dropdowon trigger
            const $variants = document.querySelectorAll(`[aria-labelledby="selectThemeDropdown"] [data-icon]`) // All items of the dropdown

            // Function to set active style in the dorpdown menu and set icon for dropdown trigger
            const setActiveStyle = function () {
                $variants.forEach($item => {
                    if ($item.getAttribute('data-value') === HSThemeAppearance.getOriginalAppearance()) {
                        $dropdownBtn.innerHTML = `<i class="${$item.getAttribute('data-icon')}" />`
                        return $item.classList.add('active')
                    }

                    $item.classList.remove('active')
                })
            }

            // Add a click event to all items of the dropdown to set the style
            $variants.forEach(function ($item) {
                $item.addEventListener('click', function () {
                    HSThemeAppearance.setAppearance($item.getAttribute('data-value'))
                })
            })

            // Call the setActiveStyle on load page
            setActiveStyle()

            // Add event listener on change style to call the setActiveStyle function
            window.addEventListener('on-hs-appearance-change', function () {
                setActiveStyle()
            })
        })()
    </script>
}